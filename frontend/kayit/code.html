<main class="flex-1">
  <section class="px-4 py-10 md:px-10 lg:px-20 max-w-[1440px] mx-auto w-full">
    <div class="max-w-md mx-auto bg-white dark:bg-[#2a1b14] rounded-2xl border border-[#f4f2f0] dark:border-white/10 p-6 md:p-8 shadow-sm">
      <h1 class="text-2xl font-black text-[#181311] dark:text-white">Kayıt Ol</h1>
      <p class="mt-1 text-sm text-[#896f61]">Yeni hesap oluşturun</p>

      <div id="alert" class="hidden mt-4 rounded-xl px-4 py-3 text-sm"></div>

      <form id="registerForm" class="mt-6 space-y-4">
        <label class="block">
          <span class="block text-sm font-medium text-[#181311] dark:text-white">Ad Soyad</span>
          <input id="name" type="text" required placeholder="Ad Soyad"
                 class="mt-1 w-full rounded-xl border-0 bg-[#f4f2f0] dark:bg-white/10 text-[#181311] dark:text-white placeholder:text-[#896f61] px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
        </label>

        <label class="block">
          <span class="block text-sm font-medium text-[#181311] dark:text-white">E-posta</span>
          <input id="email" type="email" required placeholder="ornek@email.com"
                 class="mt-1 w-full rounded-xl border-0 bg-[#f4f2f0] dark:bg-white/10 text-[#181311] dark:text-white placeholder:text-[#896f61] px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
        </label>

        <label class="block">
          <span class="block text-sm font-medium text-[#181311] dark:text-white">Şifre</span>
          <input id="password" type="password" required minlength="6" placeholder="En az 6 karakter"
                 class="mt-1 w-full rounded-xl border-0 bg-[#f4f2f0] dark:bg-white/10 text-[#181311] dark:text-white placeholder:text-[#896f61] px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
        </label>

        <label class="block">
          <span class="block text-sm font-medium text-[#181311] dark:text-white">Şifre (Tekrar)</span>
          <input id="password2" type="password" required minlength="6" placeholder="Şifreyi tekrar girin"
                 class="mt-1 w-full rounded-xl border-0 bg-[#f4f2f0] dark:bg-white/10 text-[#181311] dark:text-white placeholder:text-[#896f61] px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
        </label>

        <button type="submit"
                class="w-full h-12 rounded-xl bg-primary text-white font-black hover:opacity-90 transition">
          Hesap Oluştur
        </button>
      </form>

      <div class="mt-6 text-sm text-center text-[#896f61]">
        Zaten hesabınız var mı?
        <a class="text-primary font-black hover:underline" href="/giris/dist/index.html">Giriş Yap</a>
      </div>

      <div class="mt-4 text-xs text-[#896f61] bg-[#f8f6f6] dark:bg-white/5 rounded-xl p-3">
        <b>Admin test:</b> E-posta adresine <code>admin</code> yazarsan admin olarak atanırsın.<br/>
        Örn: <code>baranadmin@test.com</code>
      </div>
    </div>
  </section>

  <script src="/assets/api.v2.js"></script>
  <script>
    // Guard: giriş yaptıysa uygun sayfaya gönder
    (function () {
      try {
        const session = JSON.parse(localStorage.getItem("melz_session") || "null");
        const user = JSON.parse(localStorage.getItem("melz_user") || "null");
        if (session && user) {
          if (user.role === "admin") window.location.href = "/admin-panel/dist/index.html";
          else window.location.href = "/hesabim/dist/index.html";
        }
      } catch (e) {}
    })();

    const alertBox = document.getElementById("alert");
    function showAlert(type, msg) {
      alertBox.className = "mt-4 rounded-xl px-4 py-3 text-sm " + (type === "error"
        ? "bg-red-50 text-red-700 border border-red-200"
        : "bg-green-50 text-green-700 border border-green-200");
      alertBox.textContent = msg;
      alertBox.classList.remove("hidden");
    }

    document.getElementById("registerForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim().toLowerCase();
      const p1 = document.getElementById("password").value;
      const p2 = document.getElementById("password2").value;

      if (p1 !== p2) {
        showAlert("error", "Şifreler aynı değil.");
        return;
      }

      const res = window.MelzApiV2.auth.register({ name, email, password: p1 });

      if (!res.ok) {
        showAlert("error", res.message || "Kayıt başarısız.");
        return;
      }

      const user = res.user;
      showAlert("success", "Kayıt başarılı. Yönlendiriliyorsunuz...");
      setTimeout(() => {
        if (user.role === "admin") window.location.href = "/admin-panel/dist/index.html";
        else window.location.href = "/hesabim/dist/index.html";
      }, 400);
    });
  </script>
</main>
