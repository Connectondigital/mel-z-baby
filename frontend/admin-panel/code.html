<main class="flex-1">
  <section class="px-4 py-10 md:px-10 lg:px-20 max-w-[1440px] mx-auto w-full">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-black text-[#181311] dark:text-white">Admin Panel</h1>
        <p class="mt-1 text-sm text-[#896f61]">Siparişler, ürünler ve özet</p>
      </div>

      <div class="flex gap-2">
        <a href="/admin-urunler/dist/index.html" class="h-10 px-4 rounded-xl bg-[#f4f2f0] text-[#181311] font-bold text-sm hover:bg-primary/10 transition flex items-center gap-2">
          <span class="material-symbols-outlined text-[18px]">inventory_2</span> Ürünler
        </a>
        <a href="/admin-siparisler/dist/index.html" class="h-10 px-4 rounded-xl bg-[#f4f2f0] text-[#181311] font-bold text-sm hover:bg-primary/10 transition flex items-center gap-2">
          <span class="material-symbols-outlined text-[18px]">receipt_long</span> Siparişler
        </a>
        <button id="logoutBtn" class="h-10 px-4 rounded-xl bg-primary text-white font-black text-sm hover:opacity-90 transition flex items-center gap-2">
          <span class="material-symbols-outlined text-[18px]">logout</span> Çıkış
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-8">
      <div class="rounded-2xl border border-[#f4f2f0] bg-white dark:bg-white/5 p-5">
        <div class="text-xs font-bold text-[#896f61] uppercase tracking-wider">Toplam Sipariş</div>
        <div id="statOrders" class="mt-2 text-3xl font-black text-[#181311] dark:text-white">0</div>
      </div>
      <div class="rounded-2xl border border-[#f4f2f0] bg-white dark:bg-white/5 p-5">
        <div class="text-xs font-bold text-[#896f61] uppercase tracking-wider">Bekleyen</div>
        <div id="statPending" class="mt-2 text-3xl font-black text-[#181311] dark:text-white">0</div>
      </div>
      <div class="rounded-2xl border border-[#f4f2f0] bg-white dark:bg-white/5 p-5">
        <div class="text-xs font-bold text-[#896f61] uppercase tracking-wider">Ürün Sayısı</div>
        <div id="statProducts" class="mt-2 text-3xl font-black text-[#181311] dark:text-white">0</div>
      </div>
      <div class="rounded-2xl border border-[#f4f2f0] bg-white dark:bg-white/5 p-5">
        <div class="text-xs font-bold text-[#896f61] uppercase tracking-wider">Toplam Ciro (Mock)</div>
        <div id="statRevenue" class="mt-2 text-3xl font-black text-[#181311] dark:text-white">₺0</div>
      </div>
    </div>

    <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="rounded-2xl border border-[#f4f2f0] bg-white dark:bg-white/5 p-6">
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-lg font-black text-[#181311] dark:text-white">Son Siparişler</h2>
          <a href="/admin-siparisler/dist/index.html" class="text-primary font-black text-sm hover:underline">Tümünü Gör</a>
        </div>
        <div id="latestOrders" class="mt-4 space-y-3"></div>
      </div>

      <div class="rounded-2xl border border-[#f4f2f0] bg-white dark:bg-white/5 p-6">
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-lg font-black text-[#181311] dark:text-white">Hızlı İşlemler</h2>
        </div>
        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
          <a href="/admin-urunler/dist/index.html" class="rounded-2xl border border-[#f4f2f0] p-4 hover:bg-primary/5 transition">
            <div class="flex items-center gap-3">
              <div class="size-10 rounded-full bg-primary/10 text-primary flex items-center justify-center">
                <span class="material-symbols-outlined">add</span>
              </div>
              <div>
                <div class="font-black text-[#181311] dark:text-white">Ürün Yönet</div>
                <div class="text-xs text-[#896f61]">Ekle / Düzenle / Sil</div>
              </div>
            </div>
          </a>
          <a href="/admin-siparisler/dist/index.html" class="rounded-2xl border border-[#f4f2f0] p-4 hover:bg-primary/5 transition">
            <div class="flex items-center gap-3">
              <div class="size-10 rounded-full bg-primary/10 text-primary flex items-center justify-center">
                <span class="material-symbols-outlined">local_shipping</span>
              </div>
              <div>
                <div class="font-black text-[#181311] dark:text-white">Sipariş Yönet</div>
                <div class="text-xs text-[#896f61]">Durum güncelle</div>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </section>

  <script src="/assets/api.v2.js"></script>
  <script>
    (function () {
      const guard = window.MelzApiV2.auth.requireAuth({ adminOnly: true });
      if (!guard.ok) {
        window.location.href = "/giris/dist/index.html";
        return;
      }

      document.getElementById("logoutBtn").addEventListener("click", () => {
        window.MelzApiV2.auth.logout();
        window.location.href = "/giris/dist/index.html";
      });

      const orders = window.MelzApiV2.admin.getOrders() || [];
      const products = window.MelzApiV2.admin.getProducts() || [];

      const pending = orders.filter(o => (o.status || "").toLowerCase().includes("bek")).length;
      const revenue = orders.reduce((sum, o) => sum + (Number(o.total || o.amount || 0) || 0), 0);

      document.getElementById("statOrders").textContent = String(orders.length);
      document.getElementById("statPending").textContent = String(pending);
      document.getElementById("statProducts").textContent = String(products.length);
      document.getElementById("statRevenue").textContent = window.MelzApiV2.fmtTRY ? window.MelzApiV2.fmtTRY(revenue) : ("₺" + revenue);

      const latest = orders.slice(0, 5);
      const box = document.getElementById("latestOrders");
      if (!latest.length) {
        box.innerHTML = '<div class="text-sm text-[#896f61]">Henüz sipariş yok.</div>';
      } else {
        box.innerHTML = latest.map(o => {
          const id = o.id || "-";
          const name = (o.customer && o.customer.name) || o.name || "Müşteri";
          const st = o.status || "Beklemede";
          const total = (window.MelzApiV2.fmtTRY ? window.MelzApiV2.fmtTRY(Number(o.total||o.amount||0)||0) : ("₺"+(Number(o.total||o.amount||0)||0)));
          return `
            <div class="rounded-xl border border-[#f4f2f0] p-4 flex items-center justify-between gap-3">
              <div class="min-w-0">
                <div class="font-black text-[#181311] dark:text-white truncate">${name}</div>
                <div class="text-xs text-[#896f61] truncate">#${id} • ${st}</div>
              </div>
              <div class="font-black text-[#181311] dark:text-white">${total}</div>
            </div>
          `;
        }).join("");
      }
    })();
  </script>
</main>
