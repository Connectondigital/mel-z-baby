<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mel'z Baby & Kids</title>

  <link rel="stylesheet" href="../../assets/style.css" />
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;600&display=swap" />

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
            colors: { 
                primary: '#d4a373',
                'melz-beige': '#faedcd',
                'melz-beige-light': '#fefae0',
                'melz-beige-dark': '#ccd5ae'
            } 
        } 
      }
    };
  </script>
</head>

<body class="bg-white text-gray-900 font-sans">

  <header class="bg-white border-b border-[#f4f2f0] sticky top-0 z-50">
    <div class="max-w-[1280px] mx-auto px-4 md:px-10 py-3">
      <div class="flex items-center justify-between gap-8">

        <a href="/anasayfa/dist/index.html" class="flex items-center gap-2 shrink-0">
          <span class="text-2xl font-black text-primary tracking-tighter">Mel'z<span class="text-gray-400 text-sm font-normal ml-1">Baby&Kids</span></span>
        </a>

        <nav class="hidden lg:flex items-center gap-7">
          <a class="text-sm font-medium hover:text-primary transition-colors" href="#">Ana Sayfa</a>
          <a class="text-sm font-medium hover:text-primary transition-colors" href="#">Shop</a>
          <a class="text-sm font-medium hover:text-primary transition-colors" href="#">Blog</a>
          <a class="text-sm font-medium hover:text-primary transition-colors" href="#">İletişim</a>
        </nav>

        <div class="flex items-center gap-3 justify-end flex-1">
          <label class="hidden md:flex flex-1 min-w-0 max-w-[420px]">
            <div class="flex w-full items-center rounded-xl bg-[#f4f2f0] px-3 h-10">
              <span class="material-symbols-outlined text-[20px] text-gray-500">search</span>
              <input class="flex-1 bg-transparent outline-none px-2 text-sm text-gray-900 placeholder:text-gray-500" placeholder="Ürün ara..." />
            </div>
          </label>

          <button class="relative flex items-center justify-center rounded-xl h-10 w-10 bg-[#f4f2f0] hover:bg-[#e8e6e4] transition-colors group"
                  aria-label="Sepet" type="button">
            <span class="material-symbols-outlined text-[22px] text-gray-700 group-hover:text-primary transition-colors">shopping_cart</span>
            
            <span id="cart-badge"
                  class="hidden absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow-sm border-2 border-white">
              0
            </span>
          </button>

          <button class="flex items-center justify-center rounded-xl h-10 w-10 bg-[#f4f2f0] hover:bg-[#e8e6e4] transition-colors"
                  aria-label="Hesap" type="button">
            <span class="material-symbols-outlined text-[22px] text-gray-700">account_circle</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-[1280px] mx-auto px-4 md:px-10 py-10">
    <h1 class="text-3xl font-black mb-8 text-[#4a4a4a]">Bebek Ürünleri</h1>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

      <article class="rounded-2xl border border-[#e8e6e4] p-4 bg-white hover:shadow-xl transition-shadow duration-300">
        <div class="aspect-[4/5] rounded-xl overflow-hidden bg-[#f4f2f0] relative group">
          <span class="absolute top-3 left-3 bg-[#e87c7c] text-white text-xs font-bold px-2 py-1 rounded-md z-10">%20</span>
          <img class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" 
               src="https://images.unsplash.com/photo-1522771930-78848d9293e8?q=80&w=800&auto=format&fit=crop" alt="Ürün 1" />
        </div>
        <div class="mt-4">
          <h3 class="font-bold text-lg text-gray-800">Organik Pamuk Tulum</h3>
          <div class="flex items-center gap-2 mt-1">
             <span class="text-lg font-bold text-primary">₺450.00</span>
             <span class="text-sm text-gray-400 line-through">₺560.00</span>
          </div>
          <button class="mt-4 w-full h-11 rounded-xl bg-primary text-white font-bold hover:bg-gray-800 transition-colors js-add-to-cart flex items-center justify-center gap-2" 
                  type="button" data-pid="1">
            Sepete Ekle
          </button>
        </div>
      </article>

      <article class="rounded-2xl border border-[#e8e6e4] p-4 bg-white hover:shadow-xl transition-shadow duration-300">
        <div class="aspect-[4/5] rounded-xl overflow-hidden bg-[#f4f2f0] relative group">
          <span class="absolute top-3 left-3 bg-[#d4a373] text-white text-xs font-bold px-2 py-1 rounded-md z-10">Yeni</span>
          <img class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" 
               src="https://images.unsplash.com/photo-1596461404969-9ae70f2830c1?q=80&w=800&auto=format&fit=crop" alt="Ürün 2" />
        </div>
        <div class="mt-4">
          <h3 class="font-bold text-lg text-gray-800">Ahşap Halka Kulesi</h3>
          <div class="flex items-center gap-2 mt-1">
             <span class="text-lg font-bold text-primary">₺320.00</span>
          </div>
          <button class="mt-4 w-full h-11 rounded-xl bg-primary text-white font-bold hover:bg-gray-800 transition-colors js-add-to-cart flex items-center justify-center gap-2" 
                  type="button" data-pid="2">
            Sepete Ekle
          </button>
        </div>
      </article>

      <article class="rounded-2xl border border-[#e8e6e4] p-4 bg-white hover:shadow-xl transition-shadow duration-300">
        <div class="aspect-[4/5] rounded-xl overflow-hidden bg-[#f4f2f0] relative group">
          <img class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" 
               src="https://images.unsplash.com/photo-1518385317765-5c1a1795db2b?q=80&w=800&auto=format&fit=crop" alt="Ürün 3" />
        </div>
        <div class="mt-4">
          <h3 class="font-bold text-lg text-gray-800">Ergonomik Kanguru</h3>
          <div class="flex items-center gap-2 mt-1">
             <span class="text-lg font-bold text-primary">₺1,250.00</span>
          </div>
          <button class="mt-4 w-full h-11 rounded-xl bg-primary text-white font-bold hover:bg-gray-800 transition-colors js-add-to-cart flex items-center justify-center gap-2" 
                  type="button" data-pid="3">
            Sepete Ekle
          </button>
        </div>
      </article>

      <article class="rounded-2xl border border-[#e8e6e4] p-4 bg-white hover:shadow-xl transition-shadow duration-300">
        <div class="aspect-[4/5] rounded-xl overflow-hidden bg-[#f4f2f0] relative group">
          <img class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" 
               src="https://images.unsplash.com/photo-1594142491913-9111867c4f4a?q=80&w=800&auto=format&fit=crop" alt="Ürün 4" />
        </div>
        <div class="mt-4">
          <h3 class="font-bold text-lg text-gray-800">Hassas Cilt Losyonu</h3>
          <div class="flex items-center gap-2 mt-1">
             <span class="text-lg font-bold text-primary">₺180.00</span>
          </div>
          <button class="mt-4 w-full h-11 rounded-xl bg-primary text-white font-bold hover:bg-gray-800 transition-colors js-add-to-cart flex items-center justify-center gap-2" 
                  type="button" data-pid="4">
            Sepete Ekle
          </button>
        </div>
      </article>

    </div>
  </main>

  <script src="../../assets/api.v2.js"></script>

  <script>
  (function () {
    if (window.__melz_cart_script_v1) return;
    window.__melz_cart_script_v1 = true;

    // --- API Yakalama ---
    function getApi() {
      // Önce MelzApiV2 (yeni), sonra MelzV2 (eski)
      return window.MelzApiV2 || window.MelzV2 || null;
    }

    // --- Toast Mesajı ---
    function toast(type, msg) {
      const api = getApi();
      try {
        if (api && typeof api.showToast === "function") return api.showToast(type, msg);
        if (api && typeof api.toast === "function") return api.toast(type, msg);
      } catch (e) {}
      // Fallback: API yoksa konsola yaz (alert kullanıcıyı baymasın)
      console.log(`[${type.toUpperCase()}] ${msg}`);
      if(type === 'error') alert(msg); 
    }

    // --- Badge Güncelleme ---
    function updateBadgeHard() {
      const badge = document.getElementById("cart-badge");
      if (!badge) return;

      const api = getApi();
      let count = 0;

      // API'den sepeti çekip saymayı dene
      if (api && typeof api.getCart === "function") {
        try {
            const cart = api.getCart() || [];
            count = cart.reduce((sum, item) => sum + (Number(item.qty) || 0), 0);
        } catch(e) { console.error(e); }
      } else {
        // API yoksa veya hata varsa, mevcut HTML'deki sayıyı artır (UI feedback)
        // Bu, API gecikirse kullanıcı "eklendi" hissi alsın diye.
        // Gerçek API bağlandığında doğrusunu yazar.
      }
      
      // Eğer API varsa ve updateCartBadge fonksiyonu varsa onu da tetikle
      if(api && typeof api.updateCartBadge === "function") {
          api.updateCartBadge();
          return; // API kendi halleder
      }

      // Manuel DOM güncelleme (Fallback)
      badge.textContent = count > 0 ? count : (badge.textContent || "0");
      if (count > 0 || parseInt(badge.textContent) > 0) badge.classList.remove("hidden");
    }

    // --- Add To Cart ---
    function callAddToCart(pid, qty) {
      const api = getApi();
      if (!api || typeof api.addToCart !== "function") {
        throw new Error("API yüklenemedi. /assets/api.v2.js yolunu kontrol et.");
      }
      // İmza: (id, qty)
      return api.addToCart(String(pid), Number(qty) || 1);
    }

    // --- Retry Logic (API geç gelirse) ---
    function bootBadgeRetry() {
      let tries = 0;
      const timer = setInterval(() => {
        tries++;
        const api = getApi();
        if (api) {
            updateBadgeHard();
            clearInterval(timer);
        }
        if (tries > 20) clearInterval(timer);
      }, 300);
    }

    // --- Başlatma ---
    function onReady(fn) {
      if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", fn);
      else fn();
    }

    onReady(function () {
      bootBadgeRetry();

      // Click Event
      document.addEventListener("click", function (e) {
        const btn = e.target.closest(".js-add-to-cart");
        if (!btn) return;
        e.preventDefault();

        const pid = btn.dataset.pid;
        if (!pid) return;

        // UI Feedback
        const oldHTML = btn.innerHTML;
        btn.disabled = true;
        btn.classList.add("opacity-75", "cursor-not-allowed");
        btn.innerHTML = `<span class="material-symbols-outlined animate-spin text-sm">progress_activity</span> Ekleniyor...`;

        try {
          callAddToCart(pid, 1);
          
          // Başarılı
          btn.innerHTML = `<span class="material-symbols-outlined text-sm">check</span> Eklendi`;
          btn.classList.replace("bg-primary", "bg-green-600");
          
          toast("success", "Ürün sepete eklendi");
          
          // Badge'i manuel artır (API gecikirse diye)
          const badge = document.getElementById("cart-badge");
          if(badge) {
              badge.textContent = parseInt(badge.textContent || 0) + 1;
              badge.classList.remove("hidden");
          }
          
        } catch (err) {
          console.error(err);
          toast("error", "Sepete eklenemedi (API yok)");
          btn.innerHTML = oldHTML;
        } finally {
          setTimeout(() => {
            btn.disabled = false;
            btn.classList.remove("opacity-75", "cursor-not-allowed", "bg-green-600");
            btn.classList.add("bg-primary");
            btn.innerHTML = oldHTML;
          }, 1000);
        }
      });
    });
  })();
  </script>
</body>
</html>