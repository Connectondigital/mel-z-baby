<main class="flex-1">
  <section class="px-4 py-10 md:px-10 lg:px-20 max-w-[1440px] mx-auto w-full">
    <div class="max-w-md mx-auto bg-white dark:bg-[#2a1b14] rounded-2xl border border-[#f4f2f0] dark:border-white/10 p-6 md:p-8 shadow-sm">
      <h1 class="text-2xl font-black text-[#181311] dark:text-white">Giriş Yap</h1>
      <p class="mt-1 text-sm text-[#896f61]">Hesabınıza giriş yapın</p>

      <div id="alert" class="hidden mt-4 rounded-xl px-4 py-3 text-sm"></div>

      <form id="loginForm" class="mt-6 space-y-4">
        <label class="block">
          <span class="block text-sm font-medium text-[#181311] dark:text-white">E-posta</span>
          <input id="email" type="email" required placeholder="ornek@email.com"
                 class="mt-1 w-full rounded-xl border-0 bg-[#f4f2f0] dark:bg-white/10 text-[#181311] dark:text-white placeholder:text-[#896f61] px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
        </label>

        <label class="block">
          <span class="block text-sm font-medium text-[#181311] dark:text-white">Şifre</span>
          <input id="password" type="password" required minlength="6" placeholder="••••••••"
                 class="mt-1 w-full rounded-xl border-0 bg-[#f4f2f0] dark:bg-white/10 text-[#181311] dark:text-white placeholder:text-[#896f61] px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
        </label>

        <div class="flex items-center justify-between text-sm">
          <label class="inline-flex items-center gap-2 text-[#896f61]">
            <input id="remember" type="checkbox" class="rounded border-[#d7c7bf]" />
            Beni hatırla
          </label>
          <a href="#" class="text-primary font-bold hover:underline">Şifremi Unuttum</a>
        </div>

        <button type="submit"
                class="w-full h-12 rounded-xl bg-primary text-white font-black hover:opacity-90 transition">
          Giriş Yap
        </button>
      </form>

      <div class="mt-6 text-sm text-center text-[#896f61]">
        Hesabınız yok mu?
        <a class="text-primary font-black hover:underline" href="/kayit/dist/index.html">Kayıt Ol</a>
      </div>

      <div class="mt-4 text-xs text-[#896f61] bg-[#f8f6f6] dark:bg-white/5 rounded-xl p-3">
        <b>Test için:</b> E-posta adresinde <code>admin</code> kelimesi geçerse admin olarak kabul edilir.<br/>
        Örn: <code>admin@test.com</code>
      </div>
    </div>
  </section>

  <script src="/assets/api.v2.js"></script>
  <script>
    // Guard: giriş yaptıysa uygun sayfaya gönder
    (function () {
      try {
        const session = JSON.parse(localStorage.getItem("melz_session") || "null");
        const user = JSON.parse(localStorage.getItem("melz_user") || "null");
        if (session && user) {
          if (user.role === "admin") window.location.href = "/admin-panel/dist/index.html";
          else window.location.href = "/hesabim/dist/index.html";
        }
      } catch (e) {}
    })();

    const alertBox = document.getElementById("alert");
    function showAlert(type, msg) {
      alertBox.className = "mt-4 rounded-xl px-4 py-3 text-sm " + (type === "error"
        ? "bg-red-50 text-red-700 border border-red-200"
        : "bg-green-50 text-green-700 border border-green-200");
      alertBox.textContent = msg;
      alertBox.classList.remove("hidden");
    }

    document.getElementById("loginForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const email = document.getElementById("email").value.trim().toLowerCase();
      const password = document.getElementById("password").value;

      if (!window.MelzApiV2 || !window.MelzApiV2.auth) {
        showAlert("error", "Sistem dosyası yüklenemedi (api.v2.js).");
        return;
      }

      const res = window.MelzApiV2.auth.login({ email, password });

      if (!res.ok) {
        showAlert("error", res.message || "E-posta veya şifre hatalı.");
        return;
      }

      const user = res.user;
      showAlert("success", "Giriş başarılı. Yönlendiriliyorsunuz...");
      setTimeout(() => {
        if (user.role === "admin") window.location.href = "/admin-panel/dist/index.html";
        else window.location.href = "/hesabim/dist/index.html";
      }, 400);
    });
  </script>
</main>
